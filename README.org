#+TITLE: Características dos surdos de Campinas e região e seu acesso à saúde
#+SUBTITLE: Análise estatística das respostas do questionário online
#+AUTHOR: Janaina de Rezende Barreto e Rafael Rodrigues de Moraes
#+DATE: Setembro/2021
#+STARTUP: inlineimages showall
#+setupfile: https://raw.githubusercontent.com/fniessen/org-html-themes/master/org/theme-readtheorg.setup
#+LANGUAGE: pt
#+OPTIONS: H:3 num:t toc:t @:t \n:nil ::t |:t ':t ^:nil f:t *:t TeX:t LaTeX:t
#+OPTIONS: date:t author:t

#+BEGIN_SRC elisp :results silent :exports none
;; exporta html como um arquivo só
;; Fonte: https://www.reddit.com/r/orgmode/comments/7dyywu/creating_a_selfcontained_html/
(defun org-html--format-image (source attributes info)
  (format "<img src=\"data:image/%s;base64,%s\"%s />"
		  (or (file-name-extension source) "")
		  (base64-encode-string
		   (with-temp-buffer
			 (insert-file-contents-literally source)
			 (buffer-string)))
		  (file-name-nondirectory source)))

#+END_SRC

* Configurações

** Pacotes do GNU R necessários para as análises

   Os seguintes pacotes do GNU R são necessários para executar as análises estatísticas presentes nas seções seguintes.

   #+BEGIN_SRC R :exports code :results silent :session 
   library(ggplot2)    # ggplot, geom_dotplot, geom_line ...
   library(readr)      # read_csv
   library(dplyr)      # %>%
   library(tidyr)      # pivot_longer
   library(stringr)    # str_sub
   library(xtable)     # xtable
   library(haven)      # write_sav
   library(gtsummary)  # tbl_summary
   #+END_SRC

** Ambiente de computação
   
   Com o intuito de facilitar a reproducibilidade dos resultados presentes no TCC, exibimos a seguir as versões do 

   Sistema Operacional
   #+begin_src sh :exports both :results output
   hostnamectl | tail -3
   #+end_src

   #+RESULTS:
   :   Operating System: Linux Mint 20.2
   :             Kernel: Linux 5.4.0-88-generic
   :       Architecture: x86-64
   
   e do software estatístico primário 
   #+begin_src R :exports both :results output :session
   sessionInfo()
   #+end_src

   #+RESULTS:
   #+begin_example
   R version 3.6.3 (2020-02-29)
   Platform: x86_64-pc-linux-gnu (64-bit)
   Running under: Linux Mint 20.2

   Matrix products: default
   BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
   LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0

   locale:
	[1] LC_CTYPE=pt_BR.UTF-8       LC_NUMERIC=C              
	[3] LC_TIME=pt_BR.UTF-8        LC_COLLATE=pt_BR.UTF-8    
	[5] LC_MONETARY=pt_BR.UTF-8    LC_MESSAGES=pt_BR.UTF-8   
	[7] LC_PAPER=pt_BR.UTF-8       LC_NAME=C                 
	[9] LC_ADDRESS=C               LC_TELEPHONE=C            
   [11] LC_MEASUREMENT=pt_BR.UTF-8 LC_IDENTIFICATION=C       

   attached base packages:
   [1] stats     graphics  grDevices utils     datasets  methods   base     

   other attached packages:
   [1] gtsummary_1.4.2 haven_2.4.0     xtable_1.8-4    stringr_1.4.0  
   [5] tidyr_1.1.2     dplyr_1.0.3     readr_1.4.0     ggplot2_3.3.3  

   loaded via a namespace (and not attached):
	[1] pillar_1.6.0        compiler_3.6.3      forcats_0.5.1      
	[4] tools_3.6.3         digest_0.6.27       lattice_0.20-41    
	[7] lifecycle_1.0.0     tibble_3.1.1        gtable_0.3.0       
   [10] pkgconfig_2.0.3     rlang_0.4.11        Matrix_1.2-18      
   [13] DBI_1.1.1.9000      cli_2.4.0           xfun_0.26          
   [16] knitr_1.32          withr_2.4.2         generics_0.1.0     
   [19] vctrs_0.3.8         hms_1.0.0           grid_3.6.3         
   [22] tidyselect_1.1.0    glue_1.4.2          R6_2.5.0           
   [25] fansi_0.4.2         survival_3.2-3      purrr_0.3.4        
   [28] blob_1.2.1          magrittr_2.0.1      splines_3.6.3      
   [31] htmltools_0.5.1.1   scales_1.1.1        ellipsis_0.3.2     
   [34] broom.helpers_1.4.0 assertthat_0.2.1    gt_0.3.1           
   [37] colorspace_2.0-0    utf8_1.2.1          stringi_1.5.3      
   [40] munsell_0.5.0       crayon_1.4.1
   #+end_example

   no qual as análises foram efetuadas.
   
   Todas as análises foram programadas e executadas no editor
   #+begin_src emacs-lisp :exports results :results drawer
   (print (emacs-version))
   #+end_src

   #+RESULTS:
   :results:
   GNU Emacs 26.3 (build 2, x86_64-pc-linux-gnu, GTK+ Version 3.24.14)
	of 2020-03-26, modified by Debian
   :end:
   , fazendo uso do Org-mode, versão
   #+begin_src emacs-lisp :exports results :results drawer
   (print (org-version))
   #+end_src

   #+RESULTS:
   :results:
   9.4.4
   :end:
   .
   
** Dados brutos

   Os dados brutos são disponibilizados pelas pesquisadoras responsáveis pelo estudo, sendo as únicas com acesso às respostas.

   #+BEGIN_SRC R :exports code :results silent :session 
   raw <- read_csv(
	 file = './raw/[Piloto] Pesquisa Unicamp Surdos RMC 2021 (respostas) - Respostas ao formulário 1.csv'
   ) %>%
	 select(         # anonimização da base de dados
	   -c(3,5,6)     # ignora 'nome', 'celular' e 'email'
	 )
   #+END_SRC

   Municípios da Região Metropolitana de Campinas

   #+BEGIN_SRC R :exports code :results silent :session 
   ## Códigos de municípios do IBGE para as cidades da RMC
   rmc <- tribble(
	 ~municipio,                 ~codigo,
	 'AMERICANA',                3501608,
	 'AMPARO',                   3501905, # adesão ainda não oficial pela ALESP
	 'ARTUR NOGUEIRA',           3503802,
	 'CAMPINAS',                 3509502,
	 'COSMOPOLIS',               3512803,
	 'ENGENHEIRO COELHO',        3515152,
	 'HOLAMBRA',                 3519055,
	 'HORTOLANDIA',              3519071,
	 'INDAIATUBA',               3520509,
	 'ITATIBA',                  3523404,
	 'JAGUARIUNA',               3524709,
	 'MONTE MOR',                3531803,
	 'MORUNGABA',                3532009,
	 'NOVA ODESSA',              3533403,
	 'PAULINIA',                 3536505,
	 'PEDREIRA',                 3537107,
	 'SANTA BARBARA D OESTE',    3545803,
	 'SANTO ANTONIO DE POSSE',   3548005,
	 'SUMARE',                   3552403,
	 'VALINHOS',                 3556206,
	 'VINHEDO',                  3556701
   )
   #+END_SRC  
   
** Tratamento dos dados

   #+BEGIN_SRC R :exports code :results silent :session 
   ## renomeia as duas primeiras colunas para nomes mais curtos
   names(raw)[ c(1,2) ] <- c('data_preenchimento', 'consentimento')

   ## tabela de reclassificação dos nomes de coluna
   headers <- data.frame(
	 orig = names(raw)                        # nomes originais
	,codes = sprintf( 'V%03d', 1:ncol(raw) )  # novos nomes: V001 até V028
	,stringsAsFactors = FALSE
   ) 

   ## novos nomes de coluna
   names(raw) <- headers$codes

   ## tabela tratada
   dat <- raw %>%
	 mutate(
	   ## CEP
	   V012 = str_trim( gsub('[[:blank:]]+','', gsub('[[:punct:]]+',' ',V012) ) )
	 ) %>%
	 transmute(
	   ## Data e hora de preenchimento do questionário
	   V001 = strptime( V001, format = '%d/%m/%Y %H:%M:%S' )
	   ## consentimento livre e esclarecido
	  ,V002
	   ## Você se comunica por LIBRAS, tem 18 anos ou mais e mora em alguma das cidades do mapa?
	  ,V003 = factor(
		 str_sub( string = V003, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim'
			,'B - Não'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Qual é a sua data de nascimento?
	  ,V004 = case_when(
		 V004 == '05/08/0081' ~ '05/08/1981'  # correção de data
		,TRUE ~ as.character(V004)
	   )
	  ,V004 = strptime( V004, format = '%d/%m/%Y' )
	   ## idade na data de preenchimento do questionário
	  ,V004_idade = as.numeric( round( ( V001 - V004 ) / 365.25, 0 ) )
	   ## Qual é o seu sexo?
	  ,V005 = factor(
		 str_sub( string = V005, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Feminino'
			,'B - Masculino'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Qual é a sua escolaridade?
	  ,V006 = factor(
		 str_sub( string = V006, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Nunca estudei'
			,'B - Fundamental (ou 1º grau)'
			,'C - Médio (ou 2º grau)'
			,'D - Superior (ou 3º grau)'
			,'E - Pós-graduação (especialização, mestrado, doutorado)'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Você trabalha?
	  ,V007 = factor(
		 str_sub( string = V007, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim, trabalho'
			,'B - Não trabalho e recebo benefício BPC/INSS'
			,'C - Não, porque sou aposentado'
			,'D - Não, porque sou estudante'
			,'E - Não, estou desempregado'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Qual é a sua cor (ou raça)?
	  ,V008 = factor(
		 str_sub( string = V008, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Preta'
			,'B - Branca'
			,'C - Parda'
			,'D - Indígena'
			,'E - Amarela'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Qual sua religião?
	  ,V009 = ifelse(
		 grepl( ' - ', V009, ignore.case = TRUE)
		,str_sub( string = V009, start = 5 )
		,V009
	   )
	  ,V009_agrp = case_when(
		 V009 == 'Evangélica' ~ 'Evangélica'
		,V009 == 'Católica' ~ 'Católica'
		,V009 == 'Batista' ~ 'Evangélica'
		,V009 == 'Umbanda / Candomblé' ~ 'Umbanda / Candomblé'
		,V009 == 'Espírita' ~ 'Espírita'
		,grepl('adventi',V009,ignore.case=TRUE)  ~ 'Adventista'
		,grepl('azaren',V009,ignore.case=TRUE)  ~ 'Evangélica'
		,grepl('congrega',V009,ignore.case=TRUE)  ~ 'Evangélica'
		,grepl('jeov',V009,ignore.case=TRUE)  ~ 'Testemunha de Jeová'
		,grepl('etodist',V009,ignore.case=TRUE)  ~ 'Metodista'
		,V009 == 'Não tenho religião' ~ 'Sem religião'
		 ,is.na(V009) ~ 'Não informada'
		,TRUE ~ 'Outra'
	   )
	   ## Qual cidade você mora?
	  ,V010 = toupper( iconv(V010, from = "UTF-8", "ASCII//TRANSLIT") )
	  ,V010 = gsub( '/'   ,' ' , V010)
	  ,V010 = gsub( ' - ' ,' ' , V010)
	  ,V010 = gsub( '-'   ,' ' , V010)
	  ,V010 = gsub( '\\.' ,' ' , V010)
	  ,V010 = gsub( "'"   ,' ' , V010)
	  ,V010 = gsub( ' SP' ,''  , V010)
	  ,V010 = case_when(
		 V010 == 'CAMPINA'                    ~ 'CAMPINAS'
		,V010 == 'CAMPINAA'                   ~ 'CAMPINAS'
		,V010 == 'EU MORO EM CAMPINAS'        ~ 'CAMPINAS'
		,V010 == 'HORTOLANDIA E CAMPINAS'     ~ 'CAMPINAS'
		,V010 == 'HOTOLANDIA'                 ~ 'HORTOLANDIA'
		,TRUE                                 ~ as.character(V010)
	   )
	  ,V010 = str_trim(V010)
	   ## Faixas de CEP, caso seja necessário inferir cidade a partir do CEP
	   ## https://www.geografos.com.br/faixas-de-cep/faixa-cep-13000-000-ao-13190-000.php
	   ## https://www.geografos.com.br/faixas-de-cep/faixa-cep-13200-000-ao-13280-000.php
	   ## https://www.geografos.com.br/faixas-de-cep/faixa-cep-13290-000-ao-13360-000.php
	   ## https://www.geografos.com.br/faixas-de-cep/faixa-cep-13370-000-ao-13479-999.php
	   ## https://www.geografos.com.br/faixas-de-cep/faixa-cep-13480-000-ao-13525-000.php
	  ,V010_rmc = FALSE
	  ,V010_rmc = case_when(
		 ## Cidade NA mas CEP iniciando com 13 pertencem à RMC
		 is.na(V010) & str_sub( V012 ,1,2 ) == 13  ~ TRUE  
		,V010 %in% rmc$municipio                   ~ TRUE
	   )
	   ## Qual bairro você mora?
	  ,V011
	   ## Qual número do seu CEP?
	  ,V012
	   ## Você tem diabetes?
	  ,V013 = factor(
		 str_sub( string = V013, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim e faço tratamento com remédios'
			,'B - Sim, mas não faço tratamento com remédios'
			,'C - Não tenho'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Você tem pressão alta?
	  ,V014 = factor(
		 str_sub( string = V014, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim e faço tratamento com remédios'
			,'B - Sim, mas não faço tratamento com remédios'
			,'C - Não tenho'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Qual é a sua opinião sobre sua saúde?
	  ,V015 = factor(
		 str_sub( string = V015, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Muito boa'
			,'B - Boa'
			,'C - Regular'
			,'D - Ruim'
			,'E - Muito ruim'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Você fuma?
	  ,V016 = factor(
		 str_sub( string = V016, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim, todos os dias'
			,'B - Sim, às vezes'
			,'C - Não'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Você toma bebidas alcoólicas?
	  ,V017 = factor(
		 str_sub( string = V017, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim, todos os dias'
			,'B - Sim, às vezes'
			,'C - Não'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Você usa os serviços de saúde do SUS, por exemplo, centros de saúde, hospitais, exames e vários outros serviços de saúde?
	  ,V018 = factor(
		 str_sub( string = V018, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim'
			,'B - Não'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Quando você vai aos serviços de saúde do SUS como você avalia a comunicação com médicos, enfermeiros e diversos profissionais nestes serviços?
	  ,V019 = factor(
		 str_sub( string = V019, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Ruim, não sabem LIBRAS e sou obrigado a oralizar'
			,'B - Ruim, não sabem LIBRAS e preciso escrever português'
			,'C - Ruim, não consigo comunicação'
			,'D - Boa, tem intérprete que me ajuda'
			,'E - Boa, porque familiar me ajuda'
			,'F - Boa, o profissional de saúde sabe LIBRAS'
		   )
		  ,start = 5
		 ) 
	   )
	   ## O intérprete da Central de Interpretação de Libras (CIL) vai no atendimento com você no serviço público de saúde SUS?
	  ,V020 = factor(
		 str_sub( string = V020, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim'
			,'B - Não, porque eu esqueço de pedir'
			,'C - Não, porque não tem intérprete livre nunca'
			,'D - Não, porque não tem na minha cidade'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Você usa a rede particular de saúde? Exemplo: hospital, médico, convênio
	  ,V021 = factor(
		 str_sub( string = V021, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim'
			,'B - Não'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Como você avalia a comunicação entre você e o profissional de saúde do convênio ou na rede particular, com médicos, enfermeiros e diversos outros profissionais, como é a comunicação?
	  ,V022 = factor(
		 str_sub( string = V022, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Ruim, não sabem LIBRAS e sou obrigado a oralizar'
			,'B - Ruim, não sabem LIBRAS e preciso escrever português'
			,'C - Ruim, não consigo comunicação'
			,'D - Boa, tem intérprete que me ajuda'
			,'E - Boa, porque familiar me ajuda'
			,'F - Boa, o profissional de saúde sabe LIBRAS'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Você usa aparelho auditivo?
	  ,V023 = factor(
		 str_sub( string = V023, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim'
			,'B - Não'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Você conseguiu seu aparelho auditivo pelo SUS?
	  ,V024 = factor(
		 str_sub( string = V024, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim'
			,'B - Não'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Como você avalia a comunicação entre você e o médico, a fonoaudióloga e os diversos outros profissionais do centro do SUS onde conseguiu o aparelho auditivo?
	  ,V025 = factor(
		 str_sub( string = V025, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Ruim, não sabe LIBRAS e sou obrigado a oralizar'
			,'B - Ruim, não sabe LIBRAS e preciso escrever português'
			,'C - Ruim, não consigo comunicação'
			,'D - Boa, tem intérprete que me ajuda'
			,'E - Boa, porque familiar me ajuda'
			,'F - Boa, o profissional de saúde sabe LIBRAS'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Você usa implante coclear?
	  ,V026 = factor(
		 str_sub( string = V026, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim'
			,'B - Não'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Você conseguiu seu implante coclear pelo SUS?
	  ,V027 = factor(
		 str_sub( string = V027, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Sim'
			,'B - Não'
		   )
		  ,start = 5
		 ) 
	   )
	   ## Como você avalia a comunicação entre você e o médico, a fonoaudióloga e os diversos outros profissionais do centro do SUS onde conseguiu o implante coclear?
	  ,V028 = factor(
		 str_sub( string = V028, start = 5 )
		,levels = str_sub(
		   c(
			 'A - Ruim, não sabe LIBRAS e sou obrigado a oralizar'
			,'B - Ruim, não sabe LIBRAS e preciso escrever português'
			,'C - Ruim, não consigo comunicação'
			,'D - Boa, tem intérprete que me ajuda'
			,'E - Boa, porque familiar me ajuda'
			,'F - Boa, o profissional de saúde sabe LIBRAS'
		   )
		  ,start = 5
		 ) 
	   )
	   ## flag de respostas válidas
	  ,VALIDA = FALSE
	  ,VALIDA = case_when(
		 ## Preenchimento   correto para 'Consentimento' e   correto para 'Público Alvo'
		 !is.na(V002) & V003 == 'Sim' & ( V004_idade >= 18 | is.na(V004_idade) ) & ( V010_rmc == TRUE | is.na(V010) ) ~ TRUE
		 ## Preenchimento   correto para 'Consentimento' e incorreto para 'Público Alvo'
		,!is.na(V002) & V003 != 'Sim' & ( V004_idade >= 18 | is.na(V004_idade) ) & ( V010_rmc == TRUE | is.na(V010) ) ~ TRUE
		 ## Preenchimento incorreto para 'Consentimento' e   correto para 'Público Alvo'
		,is.na(V002)  & V003 == 'Sim' & ( V004_idade >= 18 | is.na(V004_idade) ) & ( V010_rmc == TRUE | is.na(V010) ) ~ TRUE
		 ## Preenchimento incorreto para 'Consentimento' e incorreto para 'Público Alvo'
		,is.na(V002)  & V003 != 'Sim' & ( V004_idade >= 18 | is.na(V004_idade) ) & ( V010_rmc == TRUE               ) ~ TRUE
	   )
	 )

   ## validação da lógica...
   ## dat %>% select( V002, V003, V004_idade, V010_rmc, V010, VALIDA) %>% View
   ## dat %>% select( V002, V003, V004_idade, V010_rmc, V010, VALIDA) %>% filter( is.na(VALIDA) ) %>% View

   ## dat %>% filter( is.na(V002), !is.na(VALIDA) ) %>% select( V002, V003, V004_idade, V010_rmc, V010, VALIDA) %>% View

   write_csv2(
	 dat
	,file = './data/respostas_tratadas.csv'
   )


   write_csv2(
	 headers
	,file = './data/headers.csv'
   )
   #+END_SRC

** Exporta dados tratados no formato apropriado ao SPSS

   #+BEGIN_SRC R :exports code :results silent :session 
   write_sav(
	 data = dat
	,path = './spss/dados_spss.sav'
   )
   #+END_SRC
   

* Análise exploratória de dados

** Evolução do número de repostas
   
*** Totais
	#+BEGIN_SRC R :exports none :results silent :session 
	## evolução cumulativa do número de respostas
	evol <- data.frame(
	  V001 = seq(
		from = as.Date( min(dat$V001) )
	   ,to = Sys.Date()
	   ,by = 'days'
	  )
	) %>%
	  left_join( dat %>% mutate( V001 = as.Date(V001) ) %>% count(V001) ) %>%
	  replace( is.na(.), 0 ) %>%   # https://stackoverflow.com/a/60941799
	  mutate( c = cumsum(n) )

	## anotações no gráfico adiante
	evol_anot <- evol %>%
	  transmute(
		x_from = V001 + 1
	   ,y_from = c
	   ,x_to = V001
	   ,y_to = c - 7
	   ,anot = case_when( 
		  V001 == '2021-09-03' ~ '03/09 Live FB Assucamp'
		 ,V001 == '2021-08-22' ~ '22/08 Releases Imprensa'
		 ,V001 == '2021-09-08' ~ '08/09 Matéria TV Câmara'
		 ,V001 == '2021-09-25' ~ '25/09 Caminhada Taquaral'
		 ,V001 == '2021-09-28' ~ '28/09 Mundo Animal'
		 ,V001 == '2021-10-06' ~ '06/10 Vídeos dos multiplicadores'
		 ,TRUE ~ ''
		)
	  ) %>%
	  filter( anot != '' )

	evol_anot[1,2] <- 0
	evol_anot[2,2] <- 20
	evol_anot[3,2] <- 40
	evol_anot[4,2] <- 60
	evol_anot[5,2] <- 80
	evol_anot[6,2] <- 100

	## Gráfico da evolução do número de respostas
	alvo <- 400
	evol_plot <- evol %>%
	  ggplot( aes( x = V001, y = c) ) +
	  geom_line() +
	  geom_point() +
	  ylim(0, alvo * 1.1 ) +
	  xlim( evol[1,1], as.Date( '2021-12-01') ) + 
	  geom_hline( yintercept = alvo, linetype = 'longdash', col='red') +
	  geom_text(
		x = evol[1,1]
	   ,y = alvo + 15
	   ,label = 'Expectativa do número de respostas'
	   ,col = 'red'
	   ,hjust = 0
	  ) +
	  geom_text(
		x = evol[ nrow(evol), 1]
	   ,y = evol[ nrow(evol), 3]
	   ,fontface = 'italic'
	   ,hjust = -0.1
	   ,label = paste0(
		  evol[ nrow(evol), 3]
		 ,' respostas até '
		 ,format( evol[ nrow(evol), 1], '%d.%m.%Y' )
		)
	  ) +
	  annotate(                # https://ggplot2-book.org/annotations.html
		geom = 'curve'
	   ,x = evol_anot[, 'x_from']
	   ,y = evol_anot[, 'y_from']
	   ,xend = evol_anot[, 'x_to']
	   ,yend = evol_anot[, 'y_to']
	   ,curvature = -0.3
	   ,arrow = arrow(length = unit(2, "mm"))
	   ,color = 'darkgrey'
	  ) +
	  annotate(
		geom = 'text'
	   ,x = evol_anot[, 'x_from']
	   ,y = evol_anot[, 'y_from']
	   ,label = evol_anot[, 'anot']
	   ,hjust = 'left'
	   ,color = 'darkgrey'
	  ) + 
	  theme_bw() +
	  labs(
		x = 'dia'
	   ,y = 'número acumulado de respostas'
	   ,title = 'Pesquisa Unicamp Surdos RMC 2021'
	   ,subtitle = 'Evolução do número acumulado de respostas por dia'
	   ,caption = paste(
		  'Obs.: Dados atualizados até'
		 ,format( Sys.time(), '%d.%m.%Y %H:%M:%S' )
		)
	  )

	ggsave( plot = evol_plot, filename = './img/evol_plot.png', width=6, height=4)
	#+END_SRC

	#+CAPTION: Evolução do número acumulado de respostas por dia
	#+ATTR_ORG: :width 600
	[[./img/evol_plot.png]]
	
*** Válidas
	#+BEGIN_SRC R :exports none :results silent :session 
	## evolução cumulativa do número de respostas
	valid <- data.frame(
	  V001 = seq(
		from = as.Date( min(dat$V001) )
	   ,to = Sys.Date()
	   ,by = 'days'
	  )
	) %>%
	  left_join( dat %>% filter( !is.na(VALIDA) ) %>% mutate( V001 = as.Date(V001) ) %>% count(V001) ) %>%
	  replace( is.na(.), 0 ) %>%   # https://stackoverflow.com/a/60941799
	  mutate( c = cumsum(n) )

	## anotações no gráfico adiante
	valid_anot <- valid %>%
	  transmute(
		x_from = V001 + 1
	   ,y_from = c
	   ,x_to = V001
	   ,y_to = c - 7
	   ,anot = case_when( 
		  V001 == '2021-09-03' ~ '03/09 Live FB Assucamp'
		 ,V001 == '2021-08-22' ~ '22/08 Releases Imprensa'
		 ,V001 == '2021-09-08' ~ '08/09 Matéria TV Câmara'
		 ,V001 == '2021-09-25' ~ '25/09 Caminhada Taquaral'
		 ,V001 == '2021-09-28' ~ '28/09 Mundo Animal'
		 ,V001 == '2021-10-06' ~ '06/10 Vídeos dos multiplicadores'
		 ,TRUE ~ ''
		)
	  ) %>%
	  filter( anot != '' )

	valid_anot[1,2] <- 0
	valid_anot[2,2] <- 20
	valid_anot[3,2] <- 40
	valid_anot[4,2] <- 60
	valid_anot[5,2] <- 80
	valid_anot[6,2] <- 100


	## Gráfico da evolução do número de respostas
	alvo <- 400
	valid_plot <- valid %>%
	  ggplot( aes( x = V001, y = c) ) +
	  geom_line() +
	  geom_point() +
	  ylim(0, alvo * 1.1 ) +
	  xlim( valid[1,1], as.Date( '2021-12-01') ) + 
	  geom_hline( yintercept = alvo, linetype = 'longdash', col='red') +
	  geom_text(
		x = valid[1,1]
	   ,y = alvo + 15
	   ,label = 'Expectativa do número de respostas'
	   ,col = 'red'
	   ,hjust = 0
	  ) +
	  geom_text(
		x = valid[ nrow(valid), 1]
	   ,y = valid[ nrow(valid), 3]
	   ,fontface = 'italic'
	   ,hjust = -0.1
	   ,label = paste0(
		  valid[ nrow(valid), 3]
		 ,' válidas até '
		 ,format( valid[ nrow(valid), 1], '%d.%m.%Y' )
		)
	  ) + 
	  annotate(                # https://ggplot2-book.org/annotations.html
		geom = 'curve'
	   ,x = valid_anot[, 'x_from']
	   ,y = valid_anot[, 'y_from']
	   ,xend = valid_anot[, 'x_to']
	   ,yend = valid_anot[, 'y_to']
	   ,curvature = -0.3
	   ,arrow = arrow(length = unit(2, "mm"))
	   ,color = 'darkgrey'
	  ) +
	  annotate(
		geom = 'text'
	   ,x = valid_anot[, 'x_from']
	   ,y = valid_anot[, 'y_from']
	   ,label = valid_anot[, 'anot']
	   ,hjust = 'left'
	   ,color = 'darkgrey'
	  ) + 
	  theme_bw() +
	  labs(
		x = 'dia'
	   ,y = 'número acumulado de respostas válidas'
	   ,title = 'Pesquisa Unicamp Surdos RMC 2021'
	   ,subtitle = 'Validação do número acumulado de respostas válidas por dia'
	   ,caption = paste(
		  'Obs.: Dados atualizados até'
		 ,format( Sys.time(), '%d.%m.%Y %H:%M:%S' )
		)
	  )

	ggsave( plot = valid_plot, filename = './img/valid_plot.png', width=6, height=4)
	#+END_SRC

	#+CAPTION: Evolução do número acumulado de respostas válidas por dia
	#+ATTR_ORG: :width 600
	[[./img/valid_plot.png]]

	
** Perfil dos participantes
   
   Até o momento da confecção deste relatório src_R[:session :results replace ]{ nrow(dat)} {{{results(=261=)}}}  pessoas participaram da pesquisa, provenientes das seguintes cidades

   #+BEGIN_SRC R :exports results :results table :colnames yes :session 
   ## cidade
   dat %>%
	 count( V010, sort = TRUE) %>%
	 mutate( f = round( n/sum(n), digits = 3) ) %>% 
	 bind_rows(
	   .
	  ,data.frame( V010 = 'RESPOSTAS', n=nrow(dat), f=1 )
	 )
   #+END_SRC

   #+RESULTS:
   | V010                      |   n |     f |
   |---------------------------+-----+-------|
   | CAMPINAS                  | 129 | 0.494 |
   | HORTOLANDIA               |  41 | 0.157 |
   | SUMARE                    |  24 | 0.092 |
   | PAULINIA                  |   9 | 0.034 |
   | VALINHOS                  |   9 | 0.034 |
   | nil                       |   7 | 0.027 |
   | AMERICANA                 |   6 | 0.023 |
   | AMPARO                    |   4 | 0.015 |
   | JAGUARIUNA                |   4 | 0.015 |
   | INDAIATUBA                |   3 | 0.011 |
   | NOVA ODESSA               |   3 | 0.011 |
   | SANTA BARBARA D OESTE     |   3 | 0.011 |
   | MONTE MOR                 |   2 | 0.008 |
   | BRASILIA, MORAVA CAMPINAS |   1 | 0.004 |
   | CACHOEIRA DE MINAS MG     |   1 | 0.004 |
   | CAPIVARI                  |   1 | 0.004 |
   | COSMOPOLIS                |   1 | 0.004 |
   | GOIANIA GOIAS             |   1 | 0.004 |
   | IRACEMAPOLIS              |   1 | 0.004 |
   | JUNDIAI                   |   1 | 0.004 |
   | LIMEIRA                   |   1 | 0.004 |
   | MARILIA                   |   1 | 0.004 |
   | MEDINA MG                 |   1 | 0.004 |
   | OSASCO                    |   1 | 0.004 |
   | POCOS DE CALDAS           |   1 | 0.004 |
   | SALTO                     |   1 | 0.004 |
   | SANTANA                   |   1 | 0.004 |
   | SAO JOSE DO RIO PARDO     |   1 | 0.004 |
   | SAO PAULO S               |   1 | 0.004 |
   | SAO VICENTE               |   1 | 0.004 |
   | RESPOSTAS                 | 261 |     1 |

   Destes, src_R[:session :results replace ]{ nrow(dat %>% filter( VALIDA == TRUE ))} {{{results(=228=)}}}  participantes pertencem ao público alvo da pesquisa, provenientes das seguintes cidades

   #+BEGIN_SRC R :exports results :results table :colnames yes :session 
   ## cidade
   dat %>%
	 filter( VALIDA == TRUE ) %>%
	 count( V010, sort = TRUE) %>%
	 mutate( f = round( n/sum(n), digits = 3) ) %>% 
	 bind_rows(
	   .
	  ,data.frame(
		 V010 = 'RESPOSTAS'
		,n = nrow( dat %>% filter(!is.na(VALIDA)) )
		,f=1
	   )
	 )
   #+END_SRC

   #+RESULTS:
   | V010                  |   n |     f |
   |-----------------------+-----+-------|
   | CAMPINAS              | 121 | 0.531 |
   | HORTOLANDIA           |  39 | 0.171 |
   | SUMARE                |  23 | 0.101 |
   | VALINHOS              |   9 | 0.039 |
   | PAULINIA              |   8 | 0.035 |
   | AMERICANA             |   6 | 0.026 |
   | JAGUARIUNA            |   4 | 0.018 |
   | nil                   |   4 | 0.018 |
   | AMPARO                |   3 | 0.013 |
   | NOVA ODESSA           |   3 | 0.013 |
   | SANTA BARBARA D OESTE |   3 | 0.013 |
   | INDAIATUBA            |   2 | 0.009 |
   | MONTE MOR             |   2 | 0.009 |
   | COSMOPOLIS            |   1 | 0.004 |
   | RESPOSTAS             | 228 |     1 |
   
   #+BEGIN_SRC R :exports none :results silent :session 
   ## Perfil dos respondentes válidos

   ## idade média
   v004 <- dat %>% filter(VALIDA == TRUE) %>% summarize( avg = mean(V004_idade, na.rm = TRUE) )
   ## sexo
   v005 <- dat %>% filter(VALIDA == TRUE) %>% count( V005, sort = TRUE) %>% mutate( p = n/sum(n) )
   ## escolaridade
   v006 <- dat %>% filter(VALIDA == TRUE) %>% count( V006) %>% mutate( p = round( n/sum(n), 3) )
   ## auto-avaliação do estado de saúde
   v015 <- dat %>% filter(VALIDA == TRUE) %>% count( V015) %>% mutate( p = round( n/sum(n), 3) )

   ## cidades não informadas
   v010 <- dat %>% filter(VALIDA == TRUE, is.na(V010) )

   ## busca livre...
   if( FALSE ) {

	 fill.color <- 'black'
	 y.lim <- c(0,1)

	 ## religião
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V009_agrp, sort = TRUE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = reorder(q, -p) ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   coord_flip() +
	   geom_text(aes(label=n), hjust=-1, color="black", size=3.5) + 
	   ylim( y.lim ) +
	   theme_classic()

	 ## trabalha
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V007, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = reorder(q, -p) ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## raça
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V008, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = reorder(q, -p) ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## diabetes
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V013, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = reorder(q, -p) ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## pressão alta
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V014, sort = TRUE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = reorder(q, -p) ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## tabagismo
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V016, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## consumo álcool
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V017, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## usa SUS
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V018, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = reorder(q, -p) ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## dos que usam SUS, avaliação da comunicação
	 dat %>%
	   filter(VALIDA == TRUE, V018 == 'Sim') %>%
	   count( V019, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   coord_flip() + 
	   geom_text(aes(label=n), hjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## dos que usam SUS, CIL acompanha?
	 dat %>%
	   filter(VALIDA == TRUE, V018 == 'Sim') %>%
	   count( V020, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   coord_flip() + 
	   geom_text(aes(label=n), hjust = -1, color=fill.color, size=3.5) +
	   theme_classic()


	 ## usa rede privada
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V021, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## dos que usam rede privada, avaliação da comunicação
	 dat %>%
	   filter(VALIDA == TRUE, V021 == 'Sim') %>%
	   count( V022, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   coord_flip() + 
	   geom_text(aes(label=n), hjust = -1, color=fill.color, size=3.5) +
	   theme_classic()


	 ## aparelho auditivo
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V023, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## dos que usam aparelho auditivo, quantos conseguiram pelo SUS?
	 dat %>%
	   filter(VALIDA == TRUE, V023 == 'Sim') %>%
	   count( V024, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## dos que usam aparelho auditivo conseguidos pelo SUS, avaliação da comunicação
	 dat %>%
	   filter(VALIDA == TRUE, V023 == 'Sim', V024 == 'Sim') %>%
	   count( V025, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   coord_flip() + 
	   geom_text(aes(label=n), hjust = -1, color=fill.color, size=3.5) +
	   theme_classic()


	 ## implante coclear
	 dat %>%
	   filter(VALIDA == TRUE) %>%
	   count( V026, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   geom_text(aes(label=n), vjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## dos que usam aparelho auditivo, quantos conseguiram pelo SUS?
	 dat %>%
	   filter(VALIDA == TRUE, V026 == 'Sim') %>%
	   count( V027, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = n, x = q, fill=p ) ) +
	   geom_bar(stat = 'identity') +
	   geom_text(aes(label=n), vjust=1.6, color="white", size=3.5)

	 ## dos que usam aparelho auditivo conseguidos pelo SUS, avaliação da comunicação
	 dat %>%
	   filter(VALIDA == TRUE, V026 == 'Sim', V027 == 'Sim') %>%
	   count( V028, sort = FALSE ) %>%
	   rename( q = 1) %>%
	   mutate( p = round( n/sum(n), 3) ) %>%
	   ggplot( aes( y = p, x = q ) ) +
	   geom_bar(stat = 'identity', fill = fill.color) +
	   ylim( y.lim ) +
	   coord_flip() + 
	   geom_text(aes(label=n), hjust = -1, color=fill.color, size=3.5) +
	   theme_classic()

	 ## aparelho auditivo e implante coclear
	 dat %>% filter(VALIDA == TRUE, V023 == 'Sim', V026 == 'Sim') %>% nrow
   }
   #+END_SRC

   Embora tenham consentido ao TCLE e confirmado residir na RMC, src_R[:session :results replace ]{ nrow(v010) } {{{results(=4=)}}} respondentes não informaram o município no qual moram; destes, src_R[:session :results replace ]{ v010 %>% filter( !is.na(V012) ) %>% nrow } {{{results(=2=)}}} informaram o CEP, do qual é possível confirmar que de fato residem na RMC. Consideramos todos eles como respostas válidas à pesquisa.

   Perfil dos participantes:

   - idade média de src_R[:session :results replace ]{ round( v004,1) } {{{results(=39.2=)}}} anos
   - src_R[:session :results replace ]{ round( v005[1,3]*100,1) } {{{results(=55.3=)}}} % do sexo src_R[:session :results replace ]{ v005[1,1] } {{{results(=Feminino=)}}}
   - src_R[:session :results replace ]{ 100*sum( v006[ c(4,5), 'p'] ) } {{{results(=40.7=)}}} % com ensino superior ou pós-graduação
   - src_R[:session :results replace ]{ 100*sum( v015[ c(1,2), 'p'] ) } {{{results(=73.7=)}}} % avaliam seu estado de saúde como bom ou muito bom

	 
** Hipóteses da pesquisa

   As seguintes hipóteses foram formuladas antes do início da coleta dos dados.

   Todas as análises nesta seção referem-se aos dados coletados até *15/10/2021*.

*** Quanto ao sexo

	#+begin_quote
	Hipótese: há uma maior prevalência da surdez entre pessoas do sexo masculino.
	#+end_quote

	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## sexo (V005)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ) %>%
	  count( V005, sort = TRUE) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V005 = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V005                       |   n |     f |
	|----------------------------+-----+-------|
	| Feminino                   | 126 | 0.553 |
	| Masculino                  | 102 | 0.447 |
	| Total de respostas válidas | 228 |     1 |

*** Quanto à escolaridade

	#+begin_quote
	Hipótese: surdos usuários de Libras possuem baixa escolaridade.
	#+end_quote

	Embora src_R[:session :results replace]{  round(100*sum( v006[1:3,3] ),1)  } {{{results(=58.8=)}}} % dos respondentes tenham escolaridade até o ensino médio, o que confirma a hipótese prévia da pesquisa, ressalta-se também o alto número de surdos com alta escolaridade (src_R[:session :results replace]{ round( 100*sum( v006[4:5,3] ), 1)} {{{results(=40.7=)}}} %).

	Em nosso ponto de vista isto se constitui em um viés da amostra, decorrente também da elevada idade média dos respondentes (src_R[:session :results replace ]{ round( v004,1) } {{{results(=39.2=)}}} anos), sugerindo que a amostra não conseguiu 'furar a bolha' dos surdos próximos à universidade.
	
	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## escolaridade (V006)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ) %>%
	  count( V006 ) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V006 = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V006                                                |   n |     f |
	|-----------------------------------------------------+-----+-------|
	| Nunca estudei                                       |   5 | 0.022 |
	| Fundamental (ou 1º grau)                            |  26 | 0.114 |
	| Médio (ou 2º grau)                                  | 103 | 0.452 |
	| Superior (ou 3º grau)                               |  71 | 0.311 |
	| Pós-graduação (especialização, mestrado, doutorado) |  22 | 0.096 |
	| nil                                                 |   1 | 0.004 |
	| Total de respostas válidas                          | 228 |     1 |

*** Quanto à religião

	#+begin_quote
	Hipótese: a maioria dos surdos é evangélico.
	#+end_quote

	Embora tenha sido confirmada a hipótese de pesquisa, chama a atenção o alto número de surdos autodeclarados sem religião (quase 1 a cada 5 surdos).
	
	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## religião (V009_agrp)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ) %>%
	  count( V009_agrp, sort=TRUE ) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V009_agrp = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V009_agrp                  |   n |     f |
	|----------------------------+-----+-------|
	| Evangélica                 |  92 | 0.404 |
	| Católica                   |  66 | 0.289 |
	| Sem religião               |  41 |  0.18 |
	| Espírita                   |   9 | 0.039 |
	| Outra                      |   6 | 0.026 |
	| Não informada              |   4 | 0.018 |
	| Adventista                 |   3 | 0.013 |
	| Testemunha de Jeová        |   3 | 0.013 |
	| Umbanda / Candomblé        |   3 | 0.013 |
	| Metodista                  |   1 | 0.004 |
	| Total de respostas válidas | 228 |     1 |

*** Quanto à situação de emprego

	#+begin_quote
	Hipótese: Há alta taxa de desemprego entre surdos
	#+end_quote

	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## trabalho (V007)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ) %>%
	  count( V007, sort = TRUE) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V007 = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V007                                     |   n |     f |
	|------------------------------------------+-----+-------|
	| Sim, trabalho                            | 146 |  0.64 |
	| Não, estou desempregado                  |  52 | 0.228 |
	| Não, porque sou aposentado               |  17 | 0.075 |
	| Não trabalho e recebo benefício BPC/INSS |  13 | 0.057 |
	| Total de respostas válidas               | 228 |     1 |

**** segmentada por nível de escolaridade

	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## trabalho (V007) por escolaridade (V006)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ) %>%
	  mutate(
		V006_grp = case_when(
		  as.character(V006) %in% c(
									'Nunca estudei'
								   ,'Fundamental (ou 1º grau)'
								   ,'Médio (ou 2º grau)'
								  ) ~ 'Médio'
		  ,TRUE ~ 'Superior'
		)
	   ,empr = case_when(
		   as.character(V007) == 'Sim, trabalho' ~ 'empregado'
		  ,as.character(V007) == 'Não, estou desempregado' ~ 'desempregado'
		 )
	  ) %>%
	  count( empr, V006 ) %>%
	  na.omit() %>%
	  pivot_wider(
		id_cols = V006
		,names_from = empr
		,values_from = n
		,values_fill = 0
	  ) %>%
	  mutate(
		pct_desempregado = round( 100*desempregado/(desempregado+empregado), 2)
	  )
	#+END_SRC

	#+RESULTS:
	| V006                                                | desempregado | empregado | pct_desempregado |
	|-----------------------------------------------------+--------------+-----------+------------------|
	| Nunca estudei                                       |            1 |         0 |              100 |
	| Fundamental (ou 1º grau)                            |            4 |         8 |            33.33 |
	| Médio (ou 2º grau)                                  |           28 |        70 |            28.57 |
	| Superior (ou 3º grau)                               |           15 |        50 |            23.08 |
	| Pós-graduação (especialização, mestrado, doutorado) |            4 |        17 |            19.05 |

**** segmentada por sexo

	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## trabalho (V007) por sexo (V005)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ) %>%
	  mutate(
		empr = case_when(
		  as.character(V007) == 'Sim, trabalho' ~ 'empregado'
		 ,as.character(V007) == 'Não, estou desempregado' ~ 'desempregado'
		)
	  ) %>% 
	  count( empr, V005 ) %>%
	  na.omit() %>%
	  pivot_wider(
		id_cols = V005
	   ,names_from = empr
	   ,values_from = n
	   ,values_fill = 0
	  ) %>%
	  mutate(
		pct_desempregado = round( 100*desempregado/(desempregado+empregado), 2)
	  )
	#+END_SRC
	
	#+RESULTS:
	| V005      | desempregado | empregado | pct_desempregado |
	|-----------+--------------+-----------+------------------|
	| Feminino  |           37 |        73 |            33.64 |
	| Masculino |           15 |        73 |            17.05 |

**** segmentada por raça

	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## trabalho (V007) por raça (V008)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ) %>%
	  mutate(
		empr = case_when(
		  as.character(V007) == 'Sim, trabalho' ~ 'empregado'
		 ,as.character(V007) == 'Não, estou desempregado' ~ 'desempregado'
		)
	  ) %>% 
	  count( empr, V008 ) %>%
	  na.omit() %>%
	  pivot_wider(
		id_cols = V008
	   ,names_from = empr
	   ,values_from = n
	   ,values_fill = 0
	  ) %>%
	  mutate(
		pct_desempregado = round( 100*desempregado/(desempregado+empregado), 2)
	  )
	#+END_SRC

	#+RESULTS:
	| V008    | desempregado | empregado | pct_desempregado |
	|---------+--------------+-----------+------------------|
	| Branca  |           34 |       116 |            22.67 |
	| Parda   |           18 |        19 |            48.65 |
	| Preta   |            0 |         5 |                0 |
	| Amarela |            0 |         6 |                0 |

**** segmentada por faixa etária

	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## trabalho (V007) por faixa etária (V004_idade)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ) %>%
	  mutate(
		faixa_etaria = cut( V004_idade, breaks = c(19,30,40,50,65,120), include.lowest = TRUE )
	   ,empr = case_when(
		   as.character(V007) == 'Sim, trabalho' ~ 'empregado'
		  ,as.character(V007) == 'Não, estou desempregado' ~ 'desempregado'
		 )
	  ) %>%
	  count( empr, faixa_etaria ) %>%
	  na.omit() %>%
	  pivot_wider(
		id_cols = faixa_etaria
	   ,names_from = empr
	   ,values_from = n
	   ,values_fill = 0
	  ) %>%
	  mutate(
		pct_desempregado = round( 100 * desempregado / (desempregado + empregado), 2) )
	#+END_SRC

	#+RESULTS:
	| faixa_etaria | desempregado | empregado | pct_desempregado |
	|--------------+--------------+-----------+------------------|
	| [19,30]      |           18 |        30 |             37.5 |
	| (30,40]      |           19 |        56 |            25.33 |
	| (40,50]      |           12 |        42 |            22.22 |
	| (50,65]      |            3 |        11 |            21.43 |
	
*** Quanto ao uso de serviços públicos de saúde (SUS)

	#+begin_quote
	Hipótese: devido à baixa escolaridade e consequentemente baixa renda, espera-se um percentual grande de usuários do serviço público de saúde.
	#+end_quote

	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## uso do SUS (V018)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ) %>%
	  count( V018, sort=TRUE ) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V018 = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V018                       |   n |    f |
	|----------------------------+-----+------|
	| Sim                        | 171 | 0.75 |
	| Não                        |  57 | 0.25 |
	| Total de respostas válidas | 228 |    1 |

*** Quanto à estrutura pública adequada de comunicação paciente-médico

	#+begin_quote
	Hipótese: ausência de estrutura pública adequada de comunicação paciente-médico, principalmente pela não disponibilização de intérprete (prefeitura) ou falta de familiares/conhecidos fluentes em LIBRAS que auxiliem o paciente.
	#+end_quote

	Em relação aos surdos que usam os serviços do SUS, resume-se a seguir a avaliação da comunicação paciente-médico
	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## comunicação profissionais do SUS (V019)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V018 == 'Sim' ) %>%
	  count( V019 ) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V019 = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V018 == 'Sim' ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V019                                                |   n |     f |
	|-----------------------------------------------------+-----+-------|
	| Ruim, não sabem LIBRAS e sou obrigado a oralizar    |  38 | 0.222 |
	| Ruim, não sabem LIBRAS e preciso escrever português |  26 | 0.152 |
	| Ruim, não consigo comunicação                       |  42 | 0.246 |
	| Boa, tem intérprete que me ajuda                    |  20 | 0.117 |
	| Boa, porque familiar me ajuda                       |  38 | 0.222 |
	| Boa, o profissional de saúde sabe LIBRAS            |   4 | 0.023 |
	| nil                                                 |   3 | 0.018 |
	| Total de respostas válidas                          | 171 |     1 |

	Em relação aos surdos que usam os serviços do SUS, resume-se a seguir a avaliação da experiência com a Central de Intérprete de Libras (CIL)
	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## Central de Intérprete de Libras (V020)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V018 == 'Sim' ) %>%
	  count( V020 ) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V020 = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V018 == 'Sim' ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V020                                       |   n |     f |
	|--------------------------------------------+-----+-------|
	| Sim                                        |  30 | 0.175 |
	| Não, porque eu esqueço de pedir            |  24 |  0.14 |
	| Não, porque não tem intérprete livre nunca |  39 | 0.228 |
	| nil                                        |  78 | 0.456 |
	| Total de respostas válidas                 | 171 |     1 |

	
	Em relação aos surdos que conseguiram seu aparelho auditivo pelo SUS, resume-se a seguir a avaliação da comunicação com o profissional do SUS
	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## aparelho auditivo pelo SUS (V025)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V023 == 'Sim', V024 == 'Sim' ) %>%
	  count( V025 ) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V025 = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V023 == 'Sim', V024 == 'Sim' ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V025                                               |  n |     f |
	|----------------------------------------------------+----+-------|
	| Ruim, não sabe LIBRAS e sou obrigado a oralizar    | 15 | 0.273 |
	| Ruim, não sabe LIBRAS e preciso escrever português |  7 | 0.127 |
	| Ruim, não consigo comunicação                      | 10 | 0.182 |
	| Boa, tem intérprete que me ajuda                   |  2 | 0.036 |
	| Boa, porque familiar me ajuda                      | 13 | 0.236 |
	| Boa, o profissional de saúde sabe LIBRAS           |  4 | 0.073 |
	| nil                                                |  4 | 0.073 |
	| Total de respostas válidas                         | 55 |     1 |


	Em relação aos surdos que conseguiram seu implante coclear pelo SUS, resume-se a seguir a avaliação da comunicação com o profissional do SUS
	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## implante coclear pelo SUS (V028)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V026 == 'Sim', V027 == 'Sim' ) %>%
	  count( V028 ) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V028 = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V026 == 'Sim', V027 == 'Sim' ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V028                                               | n |     f |
	|----------------------------------------------------+---+-------|
	| Ruim, não sabe LIBRAS e sou obrigado a oralizar    | 3 | 0.375 |
	| Ruim, não sabe LIBRAS e preciso escrever português | 2 |  0.25 |
	| Boa, porque familiar me ajuda                      | 2 |  0.25 |
	| Boa, o profissional de saúde sabe LIBRAS           | 1 | 0.125 |
	| Total de respostas válidas                         | 8 |     1 |

*** Quanto ao uso de serviços privados de saúde

	#+begin_quote
	Hipótese: devido à baixa escolaridade e consequentemente baixa renda, espera-se um percentual pequeno de usuários do serviço privado de saúde.
	#+end_quote

	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## uso de serviços privados (V021)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ) %>%
	  count( V021, sort=TRUE ) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V021 = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V021                       |   n |     f |
	|----------------------------+-----+-------|
	| Sim                        | 178 | 0.781 |
	| Não                        |  50 | 0.219 |
	| Total de respostas válidas | 228 |     1 |

*** Quanto à estrutura privada adequada de comunicação paciente-médico

	#+begin_quote
	Hipótese: ausência de estrutura privada adequada de comunicação paciente-médico, principalmente pela não disponibilização de intérprete (prefeitura e plano de saúde/convênio) ou falta de familiares/conhecidos fluentes em LIBRAS que auxiliem o paciente.
	#+end_quote

	Em relação aos surdos que usam os serviços privados de saúde, resume-se a seguir a avaliação da comunicação paciente-médico
	#+BEGIN_SRC R :exports results :results table :colnames yes :session 
	## comunicação profissionais da rede privada (V022)
	dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V021 == 'Sim' ) %>%
	  count( V022 ) %>%
	  mutate( f = round( n/sum(n), digits = 3) ) %>% 
	  bind_rows(
		.
	   ,data.frame(
		  V022 = 'Total de respostas válidas'
		 ,n=nrow(dat %>% filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V021 == 'Sim' ))
		 ,f=1
		)
	  )
	#+END_SRC

	#+RESULTS:
	| V022                                                |   n |     f |
	|-----------------------------------------------------+-----+-------|
	| Ruim, não sabem LIBRAS e sou obrigado a oralizar    |  38 | 0.213 |
	| Ruim, não sabem LIBRAS e preciso escrever português |  27 | 0.152 |
	| Ruim, não consigo comunicação                       |  54 | 0.303 |
	| Boa, tem intérprete que me ajuda                    |  15 | 0.084 |
	| Boa, porque familiar me ajuda                       |  34 | 0.191 |
	| Boa, o profissional de saúde sabe LIBRAS            |   2 | 0.011 |
	| nil                                                 |   8 | 0.045 |
	| Total de respostas válidas                          | 178 |     1 |


* Conclusões

  Observações preliminares:
  
  1. Tendo em vista que a amostra que embasa este estudo não foi determinada probabilisticamente a partir de um sistema de referência, o qual não existe, os achados e conclusões são restritos à própria amostra e portanto não podem ser generalizados além dela. São inválidas portanto generalizações como "a idade média dos surdos da RMC é src_R[:session :results replace ]{ round( v004,1) } {{{results(=39.2=)}}} anos" ou "src_R[:session :results replace ]{ 100*sum( v015[ c(1,2), 'p'] ) } {{{results(=73.7=)}}} % dos surdos paulistas avaliam seu estado de saúde como bom ou muito bom".
  2. Toda e qualquer conclusão deve ser feita somente em relação aos src_R[:session :results replace ]{ nrow(dat %>% filter(VALIDA) ) } {{{results(=228=)}}} participantes.
  3. Pesquisas online, e especialmente esta que contém vídeos, geralmente introduzem vícios sócio-econômicos nos dados. Nossa pesquisa pressupõe que os participantes tenham acesso a meios eletrônicos (como computadores e celulares) e à internet de alta velocidade (como WIFI caseira ou planos móveis de banda larga), o que invariavelmente introduz um viés na pesquisa por deixar de fora dela aqueles participantes sem acesso a tais meios.

** Comparação da comunicação paciente-médico no serviço público versus serviço privado

	#+BEGIN_SRC R :exports none :results silent :session 
	## V019 (V018=='Sim') versus V022 (V021=='Sim')
	bind_rows( 
	  dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V018 == 'Sim' ) %>%
	  count( V019 ) %>% # serviço público
	  na.omit() %>%
	  rename( resposta = 1 ) %>%
	  mutate(
		p = n / sum(n)
	   ,servico = 'público'
	   ,comunicacao = case_when(
		  str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		 ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		)
	   ,estrutura = case_when(
		  str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		 ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		 ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		)
	  ) 
	 ,dat %>%
	  filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V021 == 'Sim' ) %>%
	  count( V022 ) %>% # serviço privado
	  rename( resposta = 1 ) %>%
	  na.omit() %>%
	  mutate(
		p = n / sum(n)
	   ,servico = 'privado'
	   ,comunicacao = case_when(
		  str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		 ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		)
	   ,estrutura = case_when(
		  str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		 ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		 ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		)
	  ) 
	) %>%
	  ggplot( aes(x = resposta, y = n, group = servico, fill = servico) ) +
	  geom_bar(stat = 'identity', position = position_dodge()) +
	  coord_flip() +
	  labs(
		title = 'Comparação Serviço Público vs Serviço Privado'
	   ,subtitle = 'Avaliação da comunicação Paciente-Médico'
	   ,x = ''
	   ,y = 'número de respostas'
	   ,caption = 'Observações:\n 1. Número de respostas da rede privada\n 2. Número de respostas da rede pública'
	   ,fill = ''
	  ) +
	  theme_bw() + 
	  theme( legend.position = 'top') 


	if (FALSE){

	  ## Avaliação da comunicação
	  bind_rows( 
		dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V018 == 'Sim' ) %>%
		count( V019 ) %>% # serviço público
		na.omit() %>%
		rename( resposta = 1 ) %>%
		mutate(
		  p = n / sum(n)
		 ,servico = 'público'
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		) 
	   ,dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V021 == 'Sim' ) %>%
		count( V022 ) %>% # serviço privado
		rename( resposta = 1 ) %>%
		na.omit() %>%
		mutate(
		  p = n / sum(n)
		 ,servico = 'privado'
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		) 
	  ) %>%
		ggplot( aes(x = comunicacao, y = n, group = servico, fill = servico) ) +
		geom_bar(stat = 'identity', position = position_dodge()) +
		coord_flip() +
		labs(
		  title = 'Comparação Serviço Público vs Serviço Privado'
		 ,subtitle = 'Avaliação da comunicação Paciente-Médico'
		 ,x = ''
		 ,y = 'número de respostas'
		 ,caption = 'Observações:\n 1. Número de respostas da rede privada\n 2. Número de respostas da rede pública'
		 ,fill = ''
		) +
		theme_bw() +
		theme( legend.position = 'top') 

	  ## Avaliação da estrutura
	  bind_rows( 
		dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V018 == 'Sim' ) %>%
		count( V019 ) %>% # serviço público
		na.omit() %>%
		rename( resposta = 1 ) %>%
		mutate(
		  p = n / sum(n)
		 ,servico = 'público'
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		) 
	   ,dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE, V021 == 'Sim' ) %>%
		count( V022 ) %>% # serviço privado
		rename( resposta = 1 ) %>%
		na.omit() %>%
		mutate(
		  p = n / sum(n)
		 ,servico = 'privado'
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		) 
	  ) %>%
		ggplot( aes(x = estrutura, y = n, group = servico, fill = servico) ) +
		geom_bar(stat = 'identity', position = position_dodge()) +
		coord_flip() + 
		labs(
		  title = 'Comparação Serviço Público vs Serviço Privado'
		 ,subtitle = 'Avaliação da estrutura de atendimento'
		 ,x = ''
		 ,y = 'número de respostas'
		 ,caption = 'Observações:\n 1. Opção de resposta "Boa, porque familiar me ajuda" reclassificada como "Ruim"\n 2. Número de respostas da rede privada\n 3. Número de respostas da rede pública'
		 ,fill = ''
		) +
		theme_bw() + 
		theme( legend.position = 'top')

	  ## Facets
	  bind_rows(
		dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V019 # resposta SUS
		 ,servico = 'público'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	   ,dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V022 # resposta rede privada
		 ,servico = 'privado'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	  ) %>%
		count( estrutura, servico, escolaridade) %>%
		na.omit() %>%
		ggplot( aes(x = estrutura, y = n, group = servico, fill = servico) ) +
		geom_bar(stat = 'identity', position = position_dodge()) +
		coord_flip() + 
		labs(
		  title = 'Comparação Serviço Público vs Serviço Privado'
		 ,subtitle = 'Avaliação da estrutura de atendimento'
		 ,x = ''
		 ,y = 'número de respostas'
		 ,caption = 'Observações:\n 1. Opção de resposta "Boa, porque familiar me ajuda" reclassificada como "Ruim"\n 2. Número de respostas da rede privada\n 3. Número de respostas da rede pública'
		 ,fill = ''
		) +
		facet_wrap( ~ escolaridade, scales = 'free') + 
		theme_bw() + 
		theme( legend.position = 'top')

	  ## Facets
	  bind_rows(
		dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V019 # resposta SUS
		 ,servico = 'público'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	   ,dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V022 # resposta rede privada
		 ,servico = 'privado'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	  ) %>%
		count( estrutura, servico, cor) %>%
		na.omit() %>%
		ggplot( aes(x = estrutura, y = n, group = servico, fill = servico) ) +
		geom_bar(stat = 'identity', position = position_dodge()) +
		coord_flip() + 
		labs(
		  title = 'Comparação Serviço Público vs Serviço Privado'
		 ,subtitle = 'Avaliação da estrutura de atendimento'
		 ,x = ''
		 ,y = 'número de respostas'
		 ,caption = 'Observações:\n 1. Opção de resposta "Boa, porque familiar me ajuda" reclassificada como "Ruim"\n 2. Número de respostas da rede privada\n 3. Número de respostas da rede pública'
		 ,fill = ''
		) +
		facet_wrap( ~ cor, scales = 'free') + 
		theme_bw() + 
		theme( legend.position = 'top')

	  ## Facets
	  bind_rows(
		dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V019 # resposta SUS
		 ,servico = 'público'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	   ,dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V022 # resposta rede privada
		 ,servico = 'privado'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	  ) %>%
		count( estrutura, servico, sexo) %>%
		na.omit() %>%
		ggplot( aes(x = estrutura, y = n, group = servico, fill = servico) ) +
		geom_bar(stat = 'identity', position = position_dodge()) +
		coord_flip() + 
		labs(
		  title = 'Comparação Serviço Público vs Serviço Privado'
		 ,subtitle = 'Avaliação da estrutura de atendimento'
		 ,x = ''
		 ,y = 'número de respostas'
		 ,caption = 'Observações:\n 1. Opção de resposta "Boa, porque familiar me ajuda" reclassificada como "Ruim"\n 2. Número de respostas da rede privada\n 3. Número de respostas da rede pública'
		 ,fill = ''
		) +
		facet_wrap( ~ sexo, scales = 'free_y') + 
		theme_bw() + 
		theme( legend.position = 'top')

	  ## Facets
	  bind_rows(
		dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V019 # resposta SUS
		 ,servico = 'público'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	   ,dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V022 # resposta rede privada
		 ,servico = 'privado'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	  ) %>%
		count( resposta, servico, sexo) %>%
		na.omit() %>%
		ggplot( aes(x = resposta, y = n, group = servico, fill = servico) ) +
		geom_bar(stat = 'identity', position = position_dodge()) +
		coord_flip() + 
		labs(
		  title = 'Comparação Serviço Público vs Serviço Privado'
		 ,subtitle = 'Avaliação da comunicação paciente-médico'
		 ,x = ''
		 ,y = 'número de respostas'
		 ,caption = 'Observações:\n 1. Número de respostas da rede privada\n 2. Número de respostas da rede pública'
		 ,fill = ''
		) +
		facet_grid( ~ sexo, scales = 'free_y') + 
		coord_flip() +
		theme_bw() + 
		theme( legend.position = 'top') 


	  ## Facets
	  bind_rows(
		dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V019 # resposta SUS
		 ,servico = 'público'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	   ,dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V022 # resposta rede privada
		 ,servico = 'privado'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	  ) %>%
		count( estrutura, servico, uso_rede) %>%
		na.omit() %>%
		ggplot( aes(x = estrutura, y = n, group = servico, fill = servico) ) +
		geom_bar(stat = 'identity', position = position_dodge()) +
		coord_flip() + 
		labs(
		  title = 'Comparação Serviço Público vs Serviço Privado'
		 ,subtitle = 'Avaliação da estrutura de atendimento'
		 ,x = ''
		 ,y = 'número de respostas'
		 ,caption = 'Observações:\n 1. Opção de resposta "Boa, porque familiar me ajuda" reclassificada como "Ruim"\n 2. Número de respostas somente da rede privada\n 3. Número de respostas somente da rede pública\n 4. Número de respostas de ambas as redes.'
		 ,fill = ''
		) +
		facet_wrap( ~ uso_rede, scales = 'free') + 
		theme_bw() + 
		theme( legend.position = 'top') 

	  ## Facets
	  bind_rows(
		dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V019 # resposta SUS
		 ,servico = 'público'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	   ,dat %>%
		filter( as.Date(V001) <= '2021-10-15', VALIDA == TRUE) %>%
		transmute(
		  resposta = V022 # resposta rede privada
		 ,servico = 'privado'
		 ,sexo = V005
		 ,escolaridade = V006
		 ,cor = V008
		 ,uso_rede = case_when(
			V018 == 'Sim' & V021 == 'Sim' ~ 'Ambas'
		   ,V018 == 'Sim' & V021 == 'Não' ~ 'Somente Pública'
		   ,V018 == 'Não' & V021 == 'Sim' ~ 'Somente Privada'
		   ,V018 == 'Não' & V021 == 'Não' ~ 'Nenhuma'
		  )
		 ,comunicacao = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		 ,estrutura = case_when(
			str_sub( resposta, start=1, end=3) == 'Rui' ~ 'Ruim'
		   ,resposta == 'Boa, porque familiar me ajuda' ~ 'Ruim'
		   ,str_sub( resposta, start=1, end=3) == 'Boa' ~ 'Boa'
		  )
		)
	  ) %>%
		count( comunicacao, servico, uso_rede) %>%
		na.omit() %>%
		ggplot( aes(x = comunicacao, y = n, group = servico, fill = servico) ) +
		geom_bar(stat = 'identity', position = position_dodge()) +
		coord_flip() + 
		labs(
		  title = 'Comparação Serviço Público vs Serviço Privado'
		 ,subtitle = 'Avaliação da comunicação paciente-médico'
		 ,x = ''
		 ,y = 'número de respostas'
		 ,caption = 'Observações:\n 1. Número de respostas somente da rede privada\n 2. Número de respostas somente da rede pública\n 3. Número de respostas de ambas as redes.'
		 ,fill = ''
		) +
		facet_wrap( ~ uso_rede, scales = 'free') + 
		theme_bw() + 
		theme( legend.position = 'top') 


	}
	#+END_SRC

   
  
** Análise de correspondência
   
   #+BEGIN_SRC R :exports none :results silent :session 

   #+END_SRC

*** Escolaridade vs Estado de Saúde
*** Religião vs Estado de Saúde
*** Trabalho vs Estado de Saúde
*** Cor/Raça vs Estado de Saúde
*** Cidade vs Estado de Saúde
*** Diabetes-Hipertensao vs Estado de Saúde
*** Fuma-Bebe vs Estado de Saúde
*** Faixa etária vs Estado de Saúde

** Resumo das variáveis                                            :noexport:

   #+BEGIN_SRC R :exports results :results silent :eval no :session 
   ## descritivo das variáveis

   ## sem segmentar
   dat %>%
	 filter( VALIDA == TRUE ) %>%
	 select( -c(V001, V002, V003, V004, V009, V010_rmc, V011, V012, VALIDA) ) %>%
	 tbl_summary(
	   missing_text = 'Não informado'
	  ,statistic = all_continuous() ~ c('{mean} ( {min} : {max} )')
	  ,label = list(
		 V004_idade ~ 'Idade'
		,V005 ~ 'Sexo'
		,V006 ~ 'Escolaridade'
		,V007 ~ 'Emprego'
		,V008 ~ 'Raça'
		,V009_agrp ~ 'Religião'
		,V010 ~ 'Município de residência'
		,V013 ~ 'Diabetes'
		,V014 ~ 'Hipertensão arterial'
		,V015 ~ 'Auto-avaliação sobre estado de saúde'
		,V016 ~ 'Tagabismo'
		,V017 ~ 'Consumo de álcool'
		,V018 ~ 'Utiliza serviços de saúde do SUS'
		,V019 ~ 'Comunicação com profissionais no SUS'
		,V020 ~ 'Acompanhamento do intérprete da Central de Interpretação de Libras (CIL)'
		,V021 ~ 'Utiliza rede particular de saúde'
		,V022 ~ 'Comunicação com profissionais na rede particular'
		,V023 ~ 'Utiliza aparelho auditivo'
		,V024 ~ 'Obteve aparelho pelo SUS'
		,V025 ~ 'Comunicação com profissionais no SUS com quem obteve aparelho'
		,V026 ~ 'Utiliza implante coclear'
		,V027 ~ 'Obteve implante coclear pelo SUS'
		,V028 ~ 'Comunicação com profissionais no SUS com quem obteve implante coclear'
	   )
	 ) %>%
	 add_n() %>%
	 bold_labels() %>%
	 modify_header(label ~ "**Variáveis pesquisadas**") %>%
	 as_gt() %>%
	 gt::gtsave( filename = './data/summary.html')


   ## por sexo (V005)
   dat %>%
	 filter( VALIDA == TRUE ) %>%
	 select( -c(V001, V002, V003, V004, V009, V010_rmc, V011, V012, VALIDA) ) %>%
	 tbl_summary(
	   by = V005
	  ,missing_text = 'Não informado'
	  ,statistic = all_continuous() ~ c('{mean} ( {min} : {max} )')
	  ,label = list(
		 V004_idade ~ 'Idade'
		,V006 ~ 'Escolaridade'
		,V007 ~ 'Emprego'
		,V008 ~ 'Raça'
		,V009_agrp ~ 'Religião'
		,V010 ~ 'Município de residência'
		,V013 ~ 'Diabetes'
		,V014 ~ 'Hipertensão arterial'
		,V015 ~ 'Auto-avaliação sobre estado de saúde'
		,V016 ~ 'Tagabismo'
		,V017 ~ 'Consumo de álcool'
		,V018 ~ 'Utiliza serviços de saúde do SUS'
		,V019 ~ 'Comunicação com profissionais no SUS'
		,V020 ~ 'Acompanhamento do intérprete da Central de Interpretação de Libras (CIL)'
		,V021 ~ 'Utiliza rede particular de saúde'
		,V022 ~ 'Comunicação com profissionais na rede particular'
		,V023 ~ 'Utiliza aparelho auditivo'
		,V024 ~ 'Obteve aparelho pelo SUS'
		,V025 ~ 'Comunicação com profissionais no SUS com quem obteve aparelho'
		,V026 ~ 'Utiliza implante coclear'
		,V027 ~ 'Obteve implante coclear pelo SUS'
		,V028 ~ 'Comunicação com profissionais no SUS com quem obteve implante coclear'
	   )
	 ) %>%
	 add_n() %>%
	 add_p() %>%
	 bold_labels() %>%
	 modify_header(label ~ "**Variáveis pesquisadas**") %>%
	 as_gt() %>%
	 gt::gtsave( filename = './data/summary_by_gender.html')



   ## por uso de aparelho auditivo (V023)
   dat %>%
	 filter( VALIDA == TRUE ) %>%
	 select( -c(V001, V002, V003, V004, V009, V010_rmc, V011, V012, VALIDA) ) %>%
	 tbl_summary(
	   by = V023
	  ,missing_text = 'Não informado'
	  ,statistic = all_continuous() ~ c('{mean} ( {min} : {max} )')
	  ,label = list(
		 V004_idade ~ 'Idade'
		,V006 ~ 'Escolaridade'
		,V007 ~ 'Emprego'
		,V008 ~ 'Raça'
		,V009_agrp ~ 'Religião'
		,V010 ~ 'Município de residência'
		,V013 ~ 'Diabetes'
		,V014 ~ 'Hipertensão arterial'
		,V015 ~ 'Auto-avaliação sobre estado de saúde'
		,V016 ~ 'Tagabismo'
		,V017 ~ 'Consumo de álcool'
		,V018 ~ 'Utiliza serviços de saúde do SUS'
		,V019 ~ 'Comunicação com profissionais no SUS'
		,V020 ~ 'Acompanhamento do intérprete da Central de Interpretação de Libras (CIL)'
		,V021 ~ 'Utiliza rede particular de saúde'
		,V022 ~ 'Comunicação com profissionais na rede particular'
		## ,V023 ~ 'Utiliza aparelho auditivo'
		,V024 ~ 'Obteve aparelho pelo SUS'
		,V025 ~ 'Comunicação com profissionais no SUS com quem obteve aparelho'
		,V026 ~ 'Utiliza implante coclear'
		,V027 ~ 'Obteve implante coclear pelo SUS'
		,V028 ~ 'Comunicação com profissionais no SUS com quem obteve implante coclear'
	   )
	 ) %>%
	 add_n() %>%
	 add_p() %>%
	 bold_labels() %>%
	 modify_header(label ~ "**Variáveis pesquisadas**") %>%
	 as_gt() %>%
	 gt::gtsave( filename = './data/summary_by_hearing_instrument.html')


   ## por uso de implante coclear (V026)
   dat %>%
	 filter( VALIDA == TRUE ) %>%
	 select( -c(V001, V002, V003, V004, V009, V010_rmc, V011, V012, VALIDA) ) %>%
	 tbl_summary(
	   by = V026
	  ,missing_text = 'Não informado'
	  ,statistic = all_continuous() ~ c('{mean} ( {min} : {max} )')
	  ,label = list(
		 V004_idade ~ 'Idade'
		,V006 ~ 'Escolaridade'
		,V007 ~ 'Emprego'
		,V008 ~ 'Raça'
		,V009_agrp ~ 'Religião'
		,V010 ~ 'Município de residência'
		,V013 ~ 'Diabetes'
		,V014 ~ 'Hipertensão arterial'
		,V015 ~ 'Auto-avaliação sobre estado de saúde'
		,V016 ~ 'Tagabismo'
		,V017 ~ 'Consumo de álcool'
		,V018 ~ 'Utiliza serviços de saúde do SUS'
		,V019 ~ 'Comunicação com profissionais no SUS'
		,V020 ~ 'Acompanhamento do intérprete da Central de Interpretação de Libras (CIL)'
		,V021 ~ 'Utiliza rede particular de saúde'
		,V022 ~ 'Comunicação com profissionais na rede particular'
		,V023 ~ 'Utiliza aparelho auditivo'
		,V024 ~ 'Obteve aparelho pelo SUS'
		,V025 ~ 'Comunicação com profissionais no SUS com quem obteve aparelho'
		## ,V026 ~ 'Utiliza implante coclear'
		,V027 ~ 'Obteve implante coclear pelo SUS'
		,V028 ~ 'Comunicação com profissionais no SUS com quem obteve implante coclear'
	   )
	 ) %>%
	 add_n() %>%
	 add_p() %>%
	 bold_labels() %>%
	 modify_header(label ~ "**Variáveis pesquisadas**") %>%
	 as_gt() %>%
	 gt::gtsave( filename = './data/summary_by_cochlear_implant.html')
   #+END_SRC



* Matriz de distâncias                                             :noexport:
  
  #+BEGIN_SRC R :exports none :results silent :session :eval no
  ## Download dos estabelecimentos do SUS
  ##download.file(url = 'ftp.datasus.gov.br/cnes/BASE_DE_DADOS_CNES_202107.ZIP', destfile = '/tmp/BASE_DE_DADOS_CNES_202107.ZIP', method = 'curl')

  unzip(
	zipfile = '~/BASE_DE_DADOS_CNES_202107.ZIP'
   ,files = c(
	  'tbEstabelecimento202107.csv'
	 ,'tbNaturezaJuridica202107.csv'
	 ,'tbTipoEstabelecimento202107.csv'
	)
   ,exdir = '/tmp/'
  )

  cnes    <- read_csv2(file = '/tmp/tbEstabelecimento202107.csv')
  natjur  <- read_csv2(file = '/tmp/tbNaturezaJuridica202107.csv')
  estab   <- read_csv2(file = '/tmp/tbTipoEstabelecimento202107.csv')

  estab_lista <- cnes %>%
	transmute(
	  CO_CNES
	 ,NO_RAZAO_SOCIAL   # nome para identificação do estabelecimento
	 ,NO_FANTASIA       # nome para identificação do estabelecimento
	 ,CO_CEP
	 ,CO_NATUREZA_JUR
	 ,CO_TIPO_ESTABELECIMENTO
	 ,CO_MUNICIPIO_GESTOR
	 ,NU_LATITUDE
	 ,NU_LONGITUDE
	) %>% 
	left_join(
	  rmc %>%
	  transmute(
		MUNICIPIO = municipio
	   ,CO_MUNICIPIO_GESTOR = as.numeric( str_sub( codigo, end=-2) )
	  )
	) %>%
	na.omit() %>%
	left_join( 
	  estab %>%
	  select(CO_TIPO_ESTABELECIMENTO, DS_TIPO_ESTABELECIMENTO) %>%
	  filter( CO_TIPO_ESTABELECIMENTO %in% c('001','006') ) # UBS e Hospitais somente...
	) %>% 
	na.omit() %>%
	left_join(
	  natjur
	) %>% 
	mutate(
	  pub_priv = case_when(
		grepl( 'AUTARQ', DS_NATUREZA_JUR, ignore.case = TRUE) ~ 'PÚBLICO'
	   ,grepl( 'MUNICI', DS_NATUREZA_JUR, ignore.case = TRUE) ~ 'PÚBLICO'
	   ,grepl( 'ESTADU', DS_NATUREZA_JUR, ignore.case = TRUE) ~ 'PÚBLICO'
	   ,TRUE ~ 'PRIVADO'
	  )
	) %>%
	select( -CO_NATUREZA_JUR, -CO_TIPO_ESTABELECIMENTO)

  write_csv2(
	estab_lista
   ,file = './data/estab_lista.csv'
  )

  ## estab_lista %>%
  ## count( MUNICIPIO, DS_TIPO_ESTABELECIMENTO) %>% 
  ##   pivot_wider(
  ## 	id_cols = MUNICIPIO
  ##    ,names_from = DS_TIPO_ESTABELECIMENTO
  ##    ,values_from = n
  ##    ,values_fill = 0
  ##   ) %>% View

  ## estab_lista %>%
  ## count( DS_TIPO_ESTABELECIMENTO, DS_NATUREZA_JUR) %>% 
  ##   pivot_wider(
  ## 	id_cols = DS_NATUREZA_JUR
  ##    ,names_from = DS_TIPO_ESTABELECIMENTO
  ##    ,values_from = n
  ##    ,values_fill = 0
  ##   ) %>% View

  ## estab_lista %>%
  ## count( MUNICIPIO, pub_priv, DS_TIPO_ESTABELECIMENTO) %>% 
  ##   pivot_wider(
  ## 	id_cols = c(MUNICIPIO, pub_priv)
  ##    ,names_from = DS_TIPO_ESTABELECIMENTO
  ##    ,values_from = n
  ##    ,values_fill = 0
  ##   ) %>%
  ##   filter(
  ##     MUNICIPIO == 'CAMPINAS'
  ##   ) %>%
  ##   View

  ## estab_lista %>%
  ##   filter(
  ##     MUNICIPIO == 'CAMPINAS'
  ##    ,pub_priv == 'PÚBLICO'
  ##    ,DS_TIPO_ESTABELECIMENTO == 'HOSPITAL'
  ##   ) %>%
  ##   select( 1,2,3) %>%
  ##   View
  #+END_SRC  

  Os estabelecimentos do SUS estão disponíveis no link ftp://ftp.datasus.gov.br/cnes/BASE_DE_DADOS_CNES_202107.ZIP, do qual serão utilizados somente os arquivos
  - =tbEstabelecimento202107.csv=
  - =tbNaturezaJuridica202107.csv= e
  - =tbTipoEstabelecimento202107.csv=.

	A tabela =tbEstabelecimento202107= contém a listagem do CNES referente a Julho de 2021; dela serão utilizados, para fins da pesquisa da Unicamp Surdos RMC 2021, os campos
  - =CO_CNES=, o código CNES do estabelecimento do SUS
  - =CO_CEP=, o CEP do estabelecimento para ser utilizado no cálculo da matriz de distâncias
  - =CO_NATUREZA_JUR=, código da natureza jurídica, a ser relacionado com a tabela =tbNaturezaJuridica202107.csv=
  - =CO_TIPO_ESTABELECIMENTO=, tipo de estabelecimento, a ser relacionado com a tabela =tbTipoEstabelecimento202107.csv=
  - =CO_MUNICIPIO_GESTOR=, o código do município do IBGE
  - =NU_LATITUDE=, latitude (em graus) para gráfico/georeferenciamento
  - e =NU_LONGITUDE=, longitude (em graus) para gráfico/georeferenciamento

  
  
